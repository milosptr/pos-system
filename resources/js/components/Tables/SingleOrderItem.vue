<template>
  <div
    v-click-outside="
      () => {
        showDelete = false
      }
    "
    v-if="order.qty"
    class="SingleOrderItem relative"
    :class="[
      { ShowDelete: showDelete },
      { 'text-red-500': order.refund },
      { 'bg-gray-400': showChangedClass && !still },
      { 'line-through': order.refund && !routeInvoice }
    ]"
    @click="shouldShowDelete">
    <div class="truncate font-semibold">{{ order.name }}</div>
    <div class="tbfs-1 flex items-center justify-between">
      <div>
        <span class="fs-14rem font-semibold">{{ order.qty }}</span> <span class="font-semibold"> x </span>
        {{ $filters.formatPrice(order.price) }},00
      </div>
      <div class="font-semibold">{{ $filters.formatPrice(order.qty * order.price) }} RSD</div>
    </div>
    <div
      v-show="!order.refund"
      class="absolute right-0 top-0 -mr-24 flex h-full w-20 items-center justify-center bg-red-500 opacity-0"
      :class="{ ShowButton: !order.refund }"
      @click="refundItem">
      <img
        :src="$filters.imgUrl('trash.svg')"
        alt="remove"
        width="32" />
    </div>
    <div
      v-show="order.refund"
      class="absolute right-0 top-0 -mr-24 flex h-full w-20 items-center justify-center bg-green-500 opacity-0"
      :class="{ ShowButton: order.refund }"
      @click="refundItem">
      <img
        :src="$filters.imgUrl('rotate-back.svg')"
        alt="remove"
        width="32" />
    </div>
  </div>
</template>

<script>
export default {
  props: {
    order: {
      type: Object,
      default: () => {}
    },
    disableRefund: {
      type: Boolean,
      default: () => false
    },
    still: {
      type: Boolean,
      default: () => false
    }
  },
  data: () => ({
    showDelete: false,
    showChangedClass: false,
    routeInvoice: false
  }),
  watch: {
    order: {
      handler(newValue, oldValue) {
        this.showChangedClass = true
        setTimeout(() => {
          this.showChangedClass = false
        }, 200)
      },
      deep: true
    }
  },
  mounted() {
    this.routeInvoice = this.$route.path === '/invoices'
  },
  methods: {
    shouldShowDelete() {
      if (this.$route.path.includes('table')) this.showDelete = !this.showDelete
    },
    refundItem() {
      this.$emit('refund')
      // this.order.refund = !this.order.refund
    }
  }
}
</script>

<style scoped>
.SingleOrderItem {
  transition: all 0.3s ease-in-out;
}
.ShowDelete {
  transform: translateX(-100px);
}
.ShowButton {
  animation: ShowButton 0.4s linear forwards;
}
.SingleOrderItemChanged {
  background: red;
}

.fs-14rem {
  font-size: 1.4rem;
}

@media (max-width: 1024px) {
  .tbfs-1 {
    font-size: 1rem;
  }

  .tbfs-1 .fs-14rem {
    font-size: 1.2rem;
  }
}

@keyframes ShowButton {
  0% {
    opacity: 0;
  }
  90% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
</style>
